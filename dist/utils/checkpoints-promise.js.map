{"version":3,"sources":["../../src/utils/checkpoints-promise.js"],"names":["Promise","require","_","emitter","waiters","on","action","stage","payload","map","w","newWaiter","resolve","events","difference","length","undefined","filter","module","exports","push"],"mappings":";;AAAA;AACA,MAAMA,UAAUC,QAAS,UAAT,CAAhB;AACA,MAAMC,IAAID,QAAS,QAAT,CAAV;;AAEA,MAAM,EAAEE,OAAF,KAAcF,QAAS,UAAT,CAApB;;AAEA,IAAIG,UAAU,EAAd;AACAD,QAAQE,EAAR,CAAY,iBAAZ,EAA8BC,UAAU;AACtC,QAAMC,QAAQD,OAAOE,OAAP,CAAeD,KAA7B;AACA;AACAH,YAAUA,QAAQK,GAAR,CAAYC,KAAK;AACzB,UAAMC,YAAY;AAChBC,eAASF,EAAEE,OADK;AAEhBC,cAAQX,EAAEY,UAAF,CAAaJ,EAAEG,MAAf,EAAuB,CAACN,KAAD,CAAvB;AAFQ,KAAlB;;AAKA,QAAII,UAAUE,MAAV,CAAiBE,MAAjB,KAA4B,CAAhC,EAAmC;AACjC;AACAJ,gBAAUC,OAAV;AACA,aAAOI,SAAP;AACD,KAJD,MAIO;AACL,aAAOL,SAAP;AACD;AACF,GAbS,CAAV;;AAeA;AACAP,YAAUF,EAAEe,MAAF,CAASb,OAAT,CAAV;AACD,CApBD;;AAsBAc,OAAOC,OAAP,GAAiB,CAAC,EAAEN,MAAF,EAAD,KACf,IAAIb,OAAJ,CAAYY,WAAW;AACrBR,UAAQgB,IAAR,CAAa;AACXR,WADW;AAEXC;AAFW,GAAb;AAID,CALD,CADF","file":"checkpoints-promise.js","sourcesContent":["// Wait for things to happen before continuing.\nconst Promise = require(`bluebird`)\nconst _ = require(`lodash`)\n\nconst { emitter } = require(`../redux`)\n\nlet waiters = []\nemitter.on(`BOOTSTRAP_STAGE`, action => {\n  const stage = action.payload.stage\n  // Remove this stage from the waiters\n  waiters = waiters.map(w => {\n    const newWaiter = {\n      resolve: w.resolve,\n      events: _.difference(w.events, [stage]),\n    }\n\n    if (newWaiter.events.length === 0) {\n      // Call resolve function then remove by returning undefined.\n      newWaiter.resolve()\n      return undefined\n    } else {\n      return newWaiter\n    }\n  })\n\n  // Cleanup null entries\n  waiters = _.filter(waiters)\n})\n\nmodule.exports = ({ events }) =>\n  new Promise(resolve => {\n    waiters.push({\n      resolve,\n      events,\n    })\n  })\n"]}