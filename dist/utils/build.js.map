{"version":3,"sources":["../../src/utils/build.js"],"names":["program","bootstrap","graphqlRunner","apiRunnerNode","graphql","copyStaticDirectory","activity","report","activityTimer","start","buildCSS","catch","reportFailure","err","end","buildProductionBundle","buildHTML","stripIndent","html","require","msg","log","panic","module","exports"],"mappings":";;;;;;;;;;;sFAeA,iBAAoBA,OAApB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACkCC,UAAUD,OAAV,CADlC;;AAAA;AAAA;AACUE,yBADV,SACUA,aADV;AAAA;AAAA,mBAGQC,cAAe,YAAf,EAA4B,EAAEC,SAASF,aAAX,EAA5B,CAHR;;AAAA;;AAKE;AACA;AACAG;;AAEIC,oBATN,GASiBC,OAAOC,aAAP,CAAsB,cAAtB,CATjB;;AAUEF,qBAASG,KAAT;AAVF;AAAA,mBAWQC,SAASV,OAAT,EAAkBW,KAAlB,CAAwB,eAAO;AACnCC,4BAAe,uBAAf,EAAuCC,GAAvC;AACD,aAFK,CAXR;;AAAA;AAcEP,qBAASQ,GAAT;;AAEAR,uBAAWC,OAAOC,aAAP,CAAsB,wCAAtB,CAAX;AACAF,qBAASG,KAAT;AAjBF;AAAA,mBAkBQM,sBAAsBf,OAAtB,EAA+BW,KAA/B,CAAqC,eAAO;AAChDC,4BAAe,sCAAf,EAAsDC,GAAtD;AACD,aAFK,CAlBR;;AAAA;AAqBEP,qBAASQ,GAAT;;AAEAR,uBAAWC,OAAOC,aAAP,CAAsB,gCAAtB,CAAX;AACAF,qBAASG,KAAT;AAxBF;AAAA,mBAyBQO,UAAUhB,OAAV,EAAmBW,KAAnB,CAAyB,eAAO;AACpCC,4BACEL,OAAOU,WAAY;;;;OADrB,EAMEJ,GANF;AAQD,aATK,CAzBR;;AAAA;AAmCEP,qBAASQ,GAAT;;AAnCF;AAAA,mBAqCQX,cAAe,aAAf,EAA6B,EAAEC,SAASF,aAAX,EAA7B,CArCR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;kBAAegB,I;;;;;;;AAbf,IAAMR,WAAWS,QAAS,aAAT,CAAjB;AACA,IAAMH,YAAYG,QAAS,cAAT,CAAlB;AACA,IAAMJ,wBAAwBI,QAAS,oBAAT,CAA9B;AACA,IAAMlB,YAAYkB,QAAS,cAAT,CAAlB;AACA,IAAMZ,SAASY,QAAS,aAAT,CAAf;AACA,IAAMhB,gBAAgBgB,QAAS,mBAAT,CAAtB;AACA,IAAMd,sBAAsBc,QAAS,yBAAT,CAA5B;;AAEA,SAASP,aAAT,CAAuBQ,GAAvB,EAA4BP,GAA5B,EAAwC;AACtCN,SAAOc,GAAP,CAAY,EAAZ;AACAd,SAAOe,KAAP,CAAaF,GAAb,EAAkBP,GAAlB;AACD;;AA0CDU,OAAOC,OAAP,GAAiBN,IAAjB","file":"build.js","sourcesContent":["/* @flow */\n\nconst buildCSS = require(`./build-css`)\nconst buildHTML = require(`./build-html`)\nconst buildProductionBundle = require(`./build-javascript`)\nconst bootstrap = require(`../bootstrap`)\nconst report = require(`../reporter`)\nconst apiRunnerNode = require(`./api-runner-node`)\nconst copyStaticDirectory = require(`./copy-static-directory`)\n\nfunction reportFailure(msg, err: Error) {\n  report.log(``)\n  report.panic(msg, err)\n}\n\nasync function html(program: any) {\n  const { graphqlRunner } = await bootstrap(program)\n\n  await apiRunnerNode(`onPreBuild`, { graphql: graphqlRunner })\n\n  // Copy files from the static directory to\n  // an equivalent static directory within public.\n  copyStaticDirectory()\n\n  let activity = report.activityTimer(`Building CSS`)\n  activity.start()\n  await buildCSS(program).catch(err => {\n    reportFailure(`Generating CSS failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Building production JavaScript bundles`)\n  activity.start()\n  await buildProductionBundle(program).catch(err => {\n    reportFailure(`Generating JavaScript bundles failed`, err)\n  })\n  activity.end()\n\n  activity = report.activityTimer(`Building static HTML for pages`)\n  activity.start()\n  await buildHTML(program).catch(err => {\n    reportFailure(\n      report.stripIndent`\n        Building static HTML for pages failed\n\n        See our docs page on debugging HTML builds for help https://goo.gl/yL9lND\n      `,\n      err\n    )\n  })\n  activity.end()\n\n  await apiRunnerNode(`onPostBuild`, { graphql: graphqlRunner })\n}\n\nmodule.exports = html\n"]}