{"version":3,"sources":["../../../src/redux/reducers/jobs.js"],"names":["_","require","moment","module","exports","state","active","done","action","type","payload","id","Error","index","findIndex","j","mergedJob","merge","createdAt","Date","now","plugin","slice","concat","completedAt","job","find","name","runTime","diff","filter"],"mappings":";;;;;;;;AAAA,IAAMA,IAAIC,QAAS,QAAT,CAAV;AACA,IAAMC,SAASD,QAAS,QAAT,CAAf;;AAEAE,OAAOC,OAAP,GAAiB,YAA8C;AAAA,MAA7CC,KAA6C,uEAArC,EAAEC,QAAQ,EAAV,EAAcC,MAAM,EAApB,EAAqC;AAAA,MAAXC,MAAW;;AAC7D,UAAQA,OAAOC,IAAf;AACE,SAAM,YAAN;AACA,SAAM,SAAN;AACE,UAAI,CAACD,OAAOE,OAAP,CAAeC,EAApB,EAAwB;AACtB,cAAM,IAAIC,KAAJ,CAAW,qDAAX,CAAN;AACD;AACD,UAAMC,QAAQb,EAAEc,SAAF,CAAYT,MAAMC,MAAlB,EAA0B;AAAA,eAAKS,EAAEJ,EAAF,KAASH,OAAOE,OAAP,CAAeC,EAA7B;AAAA,OAA1B,CAAd;AACA,UAAMK,YAAYhB,EAAEiB,KAAF,CAAQZ,MAAMC,MAAN,CAAaO,KAAb,CAAR,6BACbL,OAAOE,OADM;AAEhBQ,mBAAWC,KAAKC,GAAL,EAFK;AAGhBC,gBAAQb,OAAOa;AAHC,SAAlB;AAKA,UAAIR,UAAU,CAAC,CAAf,EAAkB;AAChB,eAAO;AACLN,gBAAMF,MAAME,IADP;AAELD,4BACKD,MAAMC,MAAN,CACAgB,KADA,CACM,CADN,EACST,KADT,EAEAU,MAFA,CAEO,CAACP,SAAD,CAFP,EAGAO,MAHA,CAGOlB,MAAMC,MAAN,CAAagB,KAAb,CAAmBT,QAAQ,CAA3B,CAHP,CADL;AAFK,SAAP;AASD,OAVD,MAUO;AACL,eAAO;AACLN,gBAAMF,MAAME,IADP;AAELD,kBAAQD,MAAMC,MAAN,CAAaiB,MAAb,CAAoB,4BAErBf,OAAOE,OAFc;AAGxBQ,uBAAWC,KAAKC,GAAL,EAHa;AAIxBC,oBAAQb,OAAOa;AAJS,aAApB;AAFH,SAAP;AAUD;;AAEH,SAAM,SAAN;AACE,UAAI,CAACb,OAAOE,OAAP,CAAeC,EAApB,EAAwB;AACtB,cAAM,IAAIC,KAAJ,CAAW,0CAAX,CAAN;AACD;AACD,UAAMY,cAAcL,KAAKC,GAAL,EAApB;AACA,UAAMK,MAAMpB,MAAMC,MAAN,CAAaoB,IAAb,CAAkB;AAAA,eAAKX,EAAEJ,EAAF,KAASH,OAAOE,OAAP,CAAeC,EAA7B;AAAA,OAAlB,CAAZ;AACA,UAAI,CAACc,GAAL,EAAU;AACR,cAAM,IAAIb,KAAJ,CACH,eAAcJ,OAAOa,MAAP,CACZM,IAAK,qCAAoCnB,OAAOE,OAAP,CACzCC,EAAG,iEAHF,CAAN;AAKD;;AAED,aAAO;AACLJ,cAAMF,MAAME,IAAN,CAAWgB,MAAX,CAAkB,4BAEjBE,GAFiB;AAGpBD,qBAHoB;AAIpBI,mBAAS1B,OAAOsB,WAAP,EAAoBK,IAApB,CAAyB3B,OAAOuB,IAAIP,SAAX,CAAzB;AAJW,WAAlB,CADD;AAQLZ,gBAAQD,MAAMC,MAAN,CAAawB,MAAb,CAAoB;AAAA,iBAAKf,EAAEJ,EAAF,KAASH,OAAOE,OAAP,CAAeC,EAA7B;AAAA,SAApB;AARH,OAAP;AAjDJ;;AA6DA,SAAON,KAAP;AACD,CA/DD","file":"jobs.js","sourcesContent":["const _ = require(`lodash`)\nconst moment = require(`moment`)\n\nmodule.exports = (state = { active: [], done: [] }, action) => {\n  switch (action.type) {\n    case `CREATE_JOB`:\n    case `SET_JOB`:\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when creating or setting job`)\n      }\n      const index = _.findIndex(state.active, j => j.id === action.payload.id)\n      const mergedJob = _.merge(state.active[index], {\n        ...action.payload,\n        createdAt: Date.now(),\n        plugin: action.plugin,\n      })\n      if (index !== -1) {\n        return {\n          done: state.done,\n          active: [\n            ...state.active\n              .slice(0, index)\n              .concat([mergedJob])\n              .concat(state.active.slice(index + 1)),\n          ],\n        }\n      } else {\n        return {\n          done: state.done,\n          active: state.active.concat([\n            {\n              ...action.payload,\n              createdAt: Date.now(),\n              plugin: action.plugin,\n            },\n          ]),\n        }\n      }\n\n    case `END_JOB`:\n      if (!action.payload.id) {\n        throw new Error(`An ID must be provided when ending a job`)\n      }\n      const completedAt = Date.now()\n      const job = state.active.find(j => j.id === action.payload.id)\n      if (!job) {\n        throw new Error(\n          `The plugin \"${action.plugin\n            .name}\" tried to end a job with the id \"${action.payload\n            .id}\" that either hasn't yet been created or has already been ended`\n        )\n      }\n\n      return {\n        done: state.done.concat([\n          {\n            ...job,\n            completedAt,\n            runTime: moment(completedAt).diff(moment(job.createdAt)),\n          },\n        ]),\n        active: state.active.filter(j => j.id !== action.payload.id),\n      }\n  }\n\n  return state\n}\n"]}